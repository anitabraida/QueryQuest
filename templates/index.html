<!DOCTYPE html>
<html>
<!-- used to be results.html-->

<head>
    <meta charset="utf-8">
    <title>Job Search</title>
    <link rel="stylesheet" href="../static/styles.css">
</head>

<body class="text-style top-left p-8 mx-auto"
    style="margin-top: -1rem; width: 100%; background-image: url('../static/hello-network.jpg'); background-size: 90em;">
    <div style="display: flex; justify-content: space-evenly;">
        <div style="margin-left: -7rem;">
            <div class="search-container">
                <div style="display: flex; justify-content: space-evenly;">
                    <h1 class="heading">Job Search</h1>
                    <a style="font-size: medium; font-weight: 500; color: darkgray; margin-top: 2.3rem;"
                        href="/trending">
                        What's trending? &#8599;
                    </a>
                </div>
                <form style="margin-left: 2rem;" action="/search">
                    <input class="form-w form-border" type="text" name="query" autofocus>
                    <button type="submit"
                        style="border-radius: 5%; border-style: solid; background: #e4e4e4;">Search</button>
                    <div class="p-05">
                        <input type="checkbox" id="toggleTF-IDFButton" name="method[]" value="tf-idf">Tf-idf
                        Search</button>
                        <input type="checkbox" id="toggleBooleanButton" name="method[]" value="boolean">Boolean
                        Search</button>
                        <input type="checkbox" id="toggleFuzzyButton" name="method[]" value="fuzzy">Fuzzy
                        Search</button>
                    </div>
                </form>
            </div>
            <div id="titleContainer" class="result-container">
                <ul style="margin-left: -3rem;" id="job-title-ul">
                    <!-- Go through each job title -->
                </ul>
            </div>
        </div>
        <div class="description-container" id="description-container">
            <!-- Show more details for a clicked job -->
        </div>
    </div>
    <script async>
        (async () => {
            // find "query" query param to be able to pass it on to search-json endpoint
            let params = (new URL(document.location)).searchParams;
            let query = params.get("query");

            // call /search-json and put into array of objs
            // loop through the array on the frontend to render all matches and handle their expand box
            const resp = await fetch(`/search-json?${params.toString()}`);
            const matches = await resp.json();

            let jobTitleList = document.getElementById('job-title-ul');

            // If query exists and no matches
            if (query.length && !matches.length) {
                let li = document.createElement('li');
                li.classList.add("error");
                li.innerHTML = "No matches were found!";
                jobTitleList.appendChild(li);
            }

            matches.forEach(match => {
                let li = document.createElement('li');
                li.classList.add("titles");
                let a = document.createElement('a');
                a.classList.add("overflow-hidden");
                a.href = match.link;
                a.innerHTML = match.title;
                li.appendChild(a);
                jobTitleList.appendChild(li);

                a.addEventListener('click', async (event) => {
                    event.preventDefault(); // Prevent default link behavior

                    renderMatchIntoDescriptionContainer(match);
                });
            });

            // pre-render first match element onto description container

            renderMatchIntoDescriptionContainer(matches[0]);
        })()

        function renderMatchIntoDescriptionContainer(match) {
            let descriptionContainer = document.getElementById('description-container');
            // Clear previous content
            descriptionContainer.innerHTML = '';

            // Create title element
            let titleElement = document.createElement('h2');
            titleElement.textContent = match.title;
            descriptionContainer.appendChild(titleElement);

            // Create link sub-heading element
            let actualJobLinkElement = document.createElement('a');
            actualJobLinkElement.textContent = match.link;
            actualJobLinkElement.href = match.link;
            actualJobLinkElement.target = "_blank";
            descriptionContainer.appendChild(actualJobLinkElement);

            // Create description element
            let descriptionElement = document.createElement('p');
            descriptionElement.textContent = match.description;
            descriptionContainer.appendChild(descriptionElement);
        }
    </script>
</body>

</html>